/*!
 * lhgcore Dialog Plugin v4.2.0
 * Date: 2012-04-19 10:55:11 
 * http://code.google.com/p/lhgdialog/
 * Copyright 2009-2012 LiHuiGang
 */

;(function( $, window, undefined ){

var _ie6 = window.ActiveXObject && !window.XMLHttpRequest,
	_fn = function(){},
	_count = 0,
	_rurl = /^url:/,
	_singleton,
	onKeyDown,
	document = window.document,
	expando = 'JDG' + (+new Date),

dialogTpl =
'<table class="ui_border">' +
	'<tbody>' +
		'<tr>' +
			'<td class="ui_lt"></td>' +
			'<td class="ui_t"></td>' +
			'<td class="ui_rt"></td>' +
		'</tr>' +
		'<tr>' +
			'<td class="ui_l"></td>' +
			'<td class="ui_c">' +
				'<div class="ui_inner">' +
				'<table class="ui_dialog">' +
					'<tbody>' +
						'<tr>' +
							'<td colspan="2">' +
								'<div class="ui_title_bar">' +
									'<div class="ui_title" unselectable="on"></div>' +
									'<div class="ui_title_buttons">' +
										'<a class="ui_min" href="javascript:void(0);" title=""><b class="ui_min_b"></b></a>' +//'<a class="ui_min" href="javascript:void(0);" title="\u6700\u5C0F\u5316"><b class="ui_min_b"></b></a>' +
										'<a class="ui_max" href="javascript:void(0);" title=""><b class="ui_max_b"></b></a>' +//'<a class="ui_max" href="javascript:void(0);" title="\u6700\u5927\u5316"><b class="ui_max_b"></b></a>' +
										'<a class="ui_res" href="javascript:void(0);" title=""><b class="ui_res_b"></b><b class="ui_res_t"></b></a>' +//'<a class="ui_res" href="javascript:void(0);" title="\u8FD8\u539F"><b class="ui_res_b"></b><b class="ui_res_t"></b></a>' +
										'<a class="ui_close" href="javascript:void(0);" title="">\xd7</a>' + //'<a class="ui_close" href="javascript:void(0);" title="\u5173\u95ED(esc\u952E)">\xd7</a>'
									'</div>' +
								'</div>' +
							'</td>' +
						'</tr>' +
						'<tr>' +
							'<td class="ui_icon"></td>' +
							'<td class="ui_main">' +
								'<div class="ui_content"></div>' +
							'</td>' +
						'</tr>' +
						'<tr>' +
							'<td colspan="2">' +
								'<div class="ui_buttons"></div>' +
							'</td>' +
						'</tr>' +
					'</tbody>' +
				'</table>' +
				'</div>' +
			'</td>' +
			'<td class="ui_r"></td>' +
		'</tr>' +
		'<tr>' +
			'<td class="ui_lb"></td>' +
			'<td class="ui_b"></td>' +
			'<td class="ui_rb"></td>' +
		'</tr>' +
	'</tbody>' +
'</table>',
	
/*!
 * _path è·å–ç»„ä»¶æ ¸å¿ƒæ–‡ä»¶lhgdialog.jsæ‰€åœ¨çš„ç»å¯¹è·¯å¾„
 * _args è·å–lhgdialog.jsæ–‡ä»¶åçš„urlå‚æ•°ç»„ï¼Œå¦‚ï¼šlhgdialog.js?self=true&skin=aeroä¸­çš„?åé¢çš„å†…å®?
 */
_args, _path = (function( script, i, me )
{
    var l = script.length;
	
	for( ; i < l; i++ )
	{
		me = !!document.querySelector ?
		    script[i].src : script[i].getAttribute('src',4);
		
		if( me.substr(me.lastIndexOf('/')).indexOf('lhgdialog') !== -1 )
		    break;
	}
	
	me = me.split('?'); _args = me[1];
	
	return me[0].substr( 0, me[0].lastIndexOf('/') + 1 );
})(document.getElementsByTagName('script'),0),        

/*!
 * è·å–urlå‚æ•°å€¼å‡½æ•?
 * @param  {String}
 * @return {String||null}
 * @demo lhgdialog.js?skin=aero | _getArgs('skin') => 'aero'
 */
_getArgs = function( name )
{
    if( _args )
	{
	    var p = _args.split('&'), i = 0, l = p.length, a;
		for( ; i < l; i++ )
		{
		    a = p[i].split('=');
			if( name === a[0] ) return a[1];
		}
	}
	return null;
},

/*! å–çš®è‚¤æ ·å¼åï¼Œé»˜è®¤ä¸º default */
_skin = _getArgs('skin') || 'default',

/*! è·å– lhgdialog å¯è·¨çº§è°ƒç”¨çš„æœ€é«˜å±‚çš?window å¯¹è±¡å’?document å¯¹è±¡ */
_doc, _top = (function(w)
{
	try{
	    _doc = w['top'].document;  // è·¨åŸŸ|æ— æƒé™?
		_doc.getElementsByTagName; // chrome æµè§ˆå™¨æœ¬åœ°å®‰å…¨é™åˆ?
	}catch(e){
	    _doc = w.document; return w;
	};
	
	// å¦‚æœæŒ‡å®šå‚æ•°selfä¸ºtrueåˆ™ä¸è·¨æ¡†æ¶å¼¹å‡ºï¼Œæˆ–ä¸ºæ¡†æ¶é›†åˆ™æ— æ³•æ˜¾ç¤ºç¬¬ä¸‰æ–¹å…ƒç´?
	if( _getArgs('self') === 'true' ||
	    _doc.getElementsByTagName('frameset').length > 0 )
	{
	    _doc = w.document; return w;
	}
	
	return w['top'];
})(window),

_root = _doc.documentElement, _doctype = _doc.compatMode === 'BackCompat';

_$doc = $(_doc), _$top = $(_top), _$html = $(_doc.getElementsByTagName('html')[0]);

/*! å¼€å¯IE6 CSSèƒŒæ™¯å›¾ç‰‡ç¼“å­˜ */
try{
	_doc.execCommand( 'BackgroundImageCache', false, true );
}catch(e){};

/*! åœ¨æœ€é¡¶å±‚é¡µé¢æ·»åŠ æ ·å¼æ–‡ä»¶ */
(function(style){
	if(!style)
	{
	    var head = _doc.getElementsByTagName('head')[0],
		    link = _doc.createElement('link');
			
		link.href = _path + 'skins/' + _skin + '.css';
	    link.rel = 'stylesheet';
		link.id = 'lhgdialoglink';
		head.insertBefore(link, head.firstChild);
	}
})(_doc.getElementById('lhgdialoglink'));

/*!
 * IE6ä¸‹Fixedæ— æŠ–åŠ¨é™æ­¢å®šä½?
 * å¦‚æœä½ çš„é¡µé¢çš„htmlå…ƒç´ è®¾å®šäº†èƒŒæ™¯å›¾ç‰‡è¯·æŠŠè®¾ç½®èƒŒæ™¯å›¾ç‰‡çš„csså†™åˆ°bodyå…ƒç´ ä¸?
 * å¦‚æœä½ ä¸éœ€è¦ç»„ä»¶é™æ­¢å®šä½ï¼ˆä¹Ÿå°±æ˜¯éšå±æ»šåŠ¨ï¼‰æˆ–æ­¤æ®µä»£ç å½±å“äº†ä½ çš„é¡µé¢å¸ƒå±€å¯å°†æ­¤æ®µä»£ç åˆ é™¤
 */
_ie6 && (function(bg){
	if( _$html.css(bg) !== 'fixed' )
	{
		_$html.css({
			zoom: 1,// é¿å…å¶å°”å‡ºç°bodyèƒŒæ™¯å›¾ç‰‡å¼‚å¸¸çš„æƒ…å†?
			backgroundImage: 'url(about:blank)',
			backgroundAttachment: 'fixed'
		});
	}
})('backgroundAttachment');

/*!----------------------------------ä»¥ä¸‹ä¸ºlhgdialogæ ¸å¿ƒä»£ç éƒ¨åˆ†----------------------------------*/

var lhgdialog = function( config )
{
	config = config || {};
	
	var api, setting = lhgdialog.setting;
		
	// åˆå¹¶é»˜è®¤é…ç½®
	for( var i in setting )
	{
		if( config[i] === undefined ) config[i] = setting[i];
	}
	
	config.id = config.id || expando + _count;
	
	// å¦‚æœå®šä¹‰äº†idå‚æ•°åˆ™è¿”å›å­˜åœ¨æ­¤idçš„çª—å£å¯¹è±?
	api = lhgdialog.list[config.id];
	if(api) return api.zindex().focus();
	
	// æŒ‰é’®é˜Ÿåˆ—
	config.button = config.button || [];
	
	config.ok &&
	config.button.push({
	    id: 'ok',
		name: config.okVal,
		callback: config.ok,
		focus: config.focus
	});
	
	config.cancel &&
	config.button.push({
	    id: 'cancel',
		name: config.cancelVal,
		callback: config.cancel
	});
	
	// zIndexå…¨å±€é…ç½®
	lhgdialog.setting.zIndex = config.zIndex;
	
	_count++;
	
	return lhgdialog.list[config.id] = _singleton ?
	    _singleton._init(config) : new lhgdialog.fn._init( config );
};

lhgdialog.fn = lhgdialog.prototype =
{
    constructor: lhgdialog,
	
	_init: function( config )
	{
	    var that = this, DOM,
		    content = config.content,
			isIfr = _rurl.test(content);
			
		that.opener = window;
		that.config = config;
		
		that.DOM = DOM = that.DOM || that._getDOM();
		that.closed = false;
		that.data = config.data;

		//åˆå§‹åŒ–zIndex
		this.initZIndex();
		
		// å‡å¦‚æç¤ºæ€§å›¾æ ‡ä¸ºçœŸé»˜è®¤ä¸æ˜¾ç¤ºæœ€å°åŒ–å’Œæœ€å¤§åŒ–æŒ‰é’®
		if( config.icon && !isIfr )
		{
		    config.min = false;
			config.max = false;
			
			DOM.icon[0].style.display = '';
			DOM.icon[0].innerHTML = '<img src="' + config.path + 'skins/icons/' + config.icon + '" class="ui_icon_bg"/>';
		}
		else
		    DOM.icon[0].style.display = 'none';

		DOM.wrap[0].style.display = 'block';
		DOM.wrap.addClass( config.skin ); // å¤šçš®è‚¤å…±å­?
		DOM.rb[0].style.cursor = config.resize ? 'se-resize' : 'auto';
		DOM.title[0].style.cursor = config.drag ? 'move' : 'auto';
		DOM.max[0].style.display = config.max ? 'inline-block' : 'none';
		DOM.min[0].style.display = config.min ? 'inline-block' : 'none';
		DOM.close[0].style.display = config.cancel === false ? 'none' : 'inline-block'; //å½“cancelå‚æ•°ä¸ºfalseæ—¶éšè—å…³é—­æŒ‰é’?
		DOM.content[0].style.padding = config.padding;
		
		that.button.apply( that, config.button );
		
		that.title( config.title )
		.content( content, true, isIfr )
		.size( config.width, config.height )
		.position( config.left, config.top )
		.time( config.time )
		[config.show?'show':'hide'](true).zindex();
		
		config.focus && that.focus();
		config.lock && that.lock();
		that._ie6PngFix()._addEvent();
		
		_singleton = null;
		
		// å‡å¦‚åŠ è½½çš„æ˜¯å•ç‹¬é¡µé¢çš„å†…å®¹é¡µconfig.initå‡½æ•°ä¼šåœ¨å†…å®¹é¡µåŠ è½½å®Œæˆåæ‰§è¡Œï¼Œè¿™é‡Œå°±ä¸æ‰§è¡Œäº†
		if( !isIfr && config.init )
		    config.init.call( that, window );
		
		return that;
	},
	/**
	 * åˆå§‹åŒ–zIndexï¼Œå¦‚æœæœ‰çˆ¶çª—å£ï¼Œå¹¶ä¸”zIndexçš„å€¼å°äºçˆ¶çª—å£ï¼Œåˆ™å–çˆ¶çª—å£çš„zIndex
	 */
	initZIndex: function() {
		var that = this;
		if(that.opener && that.opener.frameElement 
				&& that.opener.frameElement.api && that.opener.frameElement.api.opener 
				&& lhgdialog.setting.zIndex < that.opener.frameElement.api.opener.lhgdialog.setting.zIndex) {
			lhgdialog.setting.zIndex = that.opener.frameElement.api.opener.lhgdialog.setting.zIndex + 3;
		}
	},
	/**
	 * è‡ªå®šä¹‰æŒ‰é’?
	 * @example
		button({
			name: 'login',
			callback: function(){},
			disabled: false,
			focus: true
		}, .., ..)
	 */
	button: function()
	{
	    var that = this, DOM = that.DOM,
		    buttons = DOM.buttons[0],
			focusButton = 'ui_state_highlight',
			listeners = that._listeners = that._listeners || {},
			ags = [].slice.call(arguments),
			i = 0, item, value, id, isNewButton, button;
			
		for( ; i < ags.length; i++ )
		{
		    item = ags[i];
			
			value = item.name;
			id = item.id || value;
			isNewButton = !listeners[id];
			button = !isNewButton ? listeners[id].elem : _doc.createElement('input');
			
			button.type = 'button';
			
            if( !listeners[id] )
                listeners[id] = {};
				
			if( value )
			    button.value = value;
			
			if( item.callback )
			    listeners[id].callback = item.callback;
				
			if( item.focus )
			{
			    that._focus && that._focus.removeClass(focusButton);
				that._focus = $(button).addClass(focusButton);
				that.focus();
			}
			
			button[expando + 'callback'] = id;
			button.disabled = !!item.disabled;
			
			if( isNewButton )
			{
			    listeners[id].elem = button;
				buttons.appendChild(button);
			}
		}
		
		buttons.style.display = ags.length ? '' : 'none';
		that._ie6SelectFix();
		
		return that;
	},
	
	/**
	 * è®¾ç½®æ ‡é¢˜
	 * @param	{String, Boolean}	æ ‡é¢˜å†…å®¹. ä¸ºfalseåˆ™éšè—æ ‡é¢˜æ 
	 * @return	{this}	å¦‚æœæ— å‚æ•°åˆ™è¿”å›å¯¹è±¡æœ¬èº«
	 */
	title: function( text )
	{
		if( text === undefined ) return this;
		
		var DOM = this.DOM,
			border = DOM.border,
			title = DOM.title[0];
			
		if( text === false )
		{
			title.style.display = 'none';
			title.innerHTML = '';
			border.addClass('ui_state_tips');
		}
		else
		{
			title.style.display = '';
			title.innerHTML = text;
			border.removeClass('ui_state_tips');
		};
		
		return this;
	},
	
	/*!
	 * è®¾ç½®å†…å®¹
	 * @param	{String}	å†…å®¹ (å¦‚æœå†…å®¹å‰?ä¸ªå­—ç¬¦ä¸ºâ€˜url:â€™å°±åŠ è½½å•ç‹¬é¡µé¢çš„å†…å®¹é¡µ)
	 * @param   {Boolean}   æ˜¯å¦ä¸ºåå¢åŠ çš„å†…å®?
	 * @param   {Boolean}   æ˜¯å¦ä½¿ç”¨iframeæ–¹å¼åŠ è½½å†…å®¹é¡?
	 * @return	{this}		å¦‚æœæ— å‚æ•°åˆ™è¿”å›å¯¹è±¡æœ¬èº«
	 */
	content: function( msg, add, frm )
	{
	    if( msg === undefined ) return this;
		
		var that = this, DOM = that.DOM,
		    wrap = DOM.wrap[0],
			width = wrap.offsetWidth,
			height = wrap.offsetHeight,
			left = parseInt(wrap.style.left),
			top = parseInt(wrap.style.top),
			cssWidth = wrap.style.width,
			$content = DOM.content,
			loading = lhgdialog.setting.content;
		
		    // å‡å¦‚å†…å®¹ä¸­å‰3ä¸ªå­—ç¬¦ä¸º'url:'å°±åŠ è½½ç›¸å¯¹è·¯å¾„çš„å•ç‹¬é¡µé¢çš„å†…å®¹é¡µ
		if( frm )
		{
			$content[0].innerHTML = loading;
			that._iframe( msg.split('url:')[1] );
		}
		else
			$content.html( msg );
		
		// æ–°å¢å†…å®¹åè°ƒæ•´ä½ç½?
		if( !add )
		{
			width = wrap.offsetWidth - width;
			height = wrap.offsetHeight - height;
			left = left - width / 2;
			top = top - height / 2;
			wrap.style.left = Math.max(left, 0) + 'px';
			wrap.style.top = Math.max(top, 0) + 'px';
			
			if( cssWidth && cssWidth !== 'auto' )
				wrap.style.width = wrap.offsetWidth + 'px';
			
			that._autoPositionType();
		}
		
		that._ie6SelectFix();
		
		return that;
	},
	
	/**
	 *	å°ºå¯¸
	 *	@param	{Number, String}	å®½åº¦
	 *	@param	{Number, String}	é«˜åº¦
	 */
	size: function( width, height )
	{
		var that = this, DOM = that.DOM,
			wrap = DOM.wrap[0],
			style = DOM.main[0].style;
		
		wrap.style.width = 'auto';
		
		if( typeof width === 'number' )
		    width = width + 'px';
		
		if( typeof height === 'number' )
		    height = height + 'px';
		
		style.width = width;
		style.height = height;
		
		if( width !== 'auto' )  // é˜²æ­¢æœªå®šä¹‰å®½åº¦çš„è¡¨æ ¼é‡åˆ°æµè§ˆå™¨å³è¾¹è¾¹ç•Œä¼¸ç¼?
		    wrap.style.width = wrap.offsetWidth + 'px';
		
		that._ie6SelectFix();
		
		return that;
	},
	
	/**
	 * ä½ç½®(ç›¸å¯¹äºå¯è§†åŒºåŸ?
	 * @param	{Number, String}
	 * @param	{Number, String}
	 */
	position: function( left, top )
	{
		var that = this,
			config = that.config,
			wrap = that.DOM.wrap[0],
			style = wrap.style,
			isFixed = _ie6 ? false : config.fixed,
			ie6Fixed = _ie6 && config.fixed,
			docLeft = _$top.scrollLeft(),
			docTop = _$top.scrollTop(),
			dl = isFixed ? 0 : docLeft,
			dt = isFixed ? 0 : docTop,
			ww = _$top.width(),
			wh = _$top.height(),
			ow = wrap.offsetWidth,
			oh = wrap.offsetHeight;
		
        if( left || left === 0 )
		{
			that._left = left.toString().indexOf('%') !== -1 ? left : null;
			left = that._toNumber(left, ww - ow);
			
			if( typeof left === 'number' )
			{
				left = ie6Fixed ? (left += docLeft) : left + dl;
				left = Math.max(left,dl) + 'px';
			}
			
			style.left = left;
		}
		
		if( top || top === 0 )
		{
			that._top = top.toString().indexOf('%') !== -1 ? top : null;
			top = that._toNumber(top, wh - oh);
			
			if( typeof top === 'number' )
			{
				top = ie6Fixed ? (top += docTop) : top + dt;
				top = Math.max(top,dt) + 'px';
			}
			
			style.top = top;
		}
		
		if( left !== undefined && top !== undefined )
		    that._autoPositionType();
		
		return that;
	},
	
	/*!
	 * å®šæ—¶å…³é—­
	 * @param	{Number}	å•ä½ä¸ºç§’, æ— å‚æ•°åˆ™åœæ­¢è®¡æ—¶å™?
	 * @param   {Function}  å…³é—­çª—å£å‰æ‰§è¡Œçš„å›è°ƒå‡½æ•°
	 */
	time: function( second, callback )
	{
		var that = this,
			timer = that._timer;
			
		timer && clearTimeout(timer);
		callback && callback.call(that);
		
		if(second)
		{
			that._timer = setTimeout(function(){
				that._click('cancel');
			}, 1000 * second);
		}
		
		return that;
	},
	
	/*! æ˜¾ç¤ºå¯¹è¯æ¡?*/
	show: function( args )
	{
		this.DOM.wrap[0].style.visibility = 'visible';
		this.DOM.border.addClass('ui_state_visible');
		
		if( !args && this._lock )
		    $('#ldg_lockmask',_doc)[0].style.display = '';
			
		return this;
	},
	
	/*! éšè—å¯¹è¯æ¡?*/
	hide: function( args )
	{
		this.DOM.wrap[0].style.visibility = 'hidden';
		this.DOM.border.removeClass('ui_state_visible');
		
		if( !args && this._lock )
		    $('#ldg_lockmask',_doc)[0].style.display = 'none';
			
		return this;
	},
	
	/*! ç½®é¡¶å¯¹è¯æ¡?*/
	zindex: function()
	{
		//åˆå§‹åŒ–zIndex
		this.initZIndex();
		
		var that = this, DOM = that.DOM,
		    load = that._load,
			top = lhgdialog.focus,
			index = lhgdialog.setting.zIndex++;
		
		// è®¾ç½®å åŠ é«˜åº¦
		DOM.wrap[0].style.zIndex = index;
		
		// è®¾ç½®æœ€é«˜å±‚çš„æ ·å¼?
		top && top.DOM.border.removeClass('ui_state_focus');
		lhgdialog.focus = that;
		DOM.border.addClass('ui_state_focus');
		
		// æ‰©å±•çª—å£ç½®é¡¶åŠŸèƒ½ï¼Œåªç”¨åœ¨iframeæ–¹å¼åŠ è½½å†…å®¹
		// æˆ–è·¨åŸŸåŠ è½½å†…å®¹é¡µæ—¶ç‚¹çª—å£å†…å®¹ä¸»ä½“éƒ¨åˆ†ç½®é¡¶çª—å£
		if( load && load.style.zIndex )
		    load.style.display = 'none';
		if( top && top !== that && top.iframe )
		    top._load.style.display = '';
		
		return that;
	},
	
	/*! è®¾ç½®ç„¦ç‚¹ */
	focus: function()
	{
	    try{
		    elemFocus = this._focus && this._focus[0] || this.DOM.close[0];
			elemFocus && elemFocus.focus();
		}catch(e){};
		
		return this;
	},
	
	/*! é”å± */
	lock: function()
	{
		//åˆå§‹åŒ–zIndex
		this.initZIndex();
		
		var that = this, frm,
		    index = lhgdialog.setting.zIndex - 1,
			config = that.config,
			mask = $('#ldg_lockmask',_doc)[0],
			style = mask ? mask.style : '',
			positionType = _ie6 ? 'absolute' : 'fixed';
		
		if( !mask )
		{
			frm = '<iframe src="javascript:\'\'" style="width:100%;height:100%;position:absolute;' +
			    'top:0;left:0;z-index:-1;filter:alpha(opacity=0)"></iframe>';
				
			mask = _doc.createElement('div');
			mask.id = 'ldg_lockmask';
			mask.style.cssText = 'position:' + positionType + ';left:0;top:0;width:100%;height:100%;overflow:hidden;background:' + config.background + ';';
			
			$(mask).css( 'opacity', config.opacity );
			
			style = mask.style;
			if( _ie6 ) mask.innerHTML = frm;
			
			_doc.body.appendChild( mask );
		}
		
		if( positionType === 'absolute' )
		{
		    style.width = _$top.width();
			style.height = _$top.height();
			style.top = _$top.scrollTop();
			style.left = _$top.scrollLeft();
			
			that._setFixed( mask );
		}

		style.zIndex = index;
		style.display = '';
		
		that.zindex();
		that.DOM.border.addClass('ui_state_lock');
		
		that._lock = true;
			
		return that;
	},
	
	/*! è§£é™¤é”å± */
	unlock: function()
	{
		var that = this,
		    config = that.config,
			mask = $('#ldg_lockmask',_doc)[0];
		
		if( mask && that._lock )
		{
		    // æ— é™çº§é”å±?
			if( config.parent && config.parent._lock )
			{
			    var index = config.parent.DOM.wrap[0].style.zIndex;
				mask.style.zIndex = parseInt(index,10) - 1;
			}
			else
			    mask.style.display = 'none';
			
			that.DOM.border.removeClass('ui_state_lock');
		}
		
		that._lock = false;
		
		return that;
	},
	
	/*! å…³é—­å¯¹è¯æ¡?*/
	close: function()
	{
		var that = this, DOM = that.DOM,
			wrap = DOM.wrap,
			list = lhgdialog.list,
			fn = that.config.close;
		
		that.time();
		
		// å½“ä½¿ç”¨iframeæ–¹å¼åŠ è½½å†…å®¹é¡µæ—¶çš„å¤„ç†ä»£ç ?
		if( that.iframe )
		{
			if( typeof  fn === 'function' && fn.call(that, that.iframe.contentWindow, window) === false )
			    return that;
			
			// é‡è¦ï¼éœ€è¦é‡ç½®iframeåœ°å€ï¼Œå¦åˆ™ä¸‹æ¬¡å‡ºç°çš„å¯¹è¯æ¡†åœ¨IE6ã€?æ— æ³•èšç„¦input
			// IEåˆ é™¤iframeåï¼Œiframeä»ç„¶ä¼šç•™åœ¨å†…å­˜ä¸­å‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œç½®æ¢srcæ˜¯æœ€å®¹æ˜“è§£å†³çš„æ–¹æ³?
			$(that.iframe).unbind('load',that._fmLoad).attr('src',"javascript:''").remove();
			
			DOM.content.removeClass('ui_state_full');
			if( that._frmTimer ) clearTimeout(that._frmTimer);
		}
		else
		{
		    if( typeof fn === 'function' && fn.call(that, window) === false )
			    return that;
		}
		
		if(!$('#ldg_lockmask',_doc)[0] && that.config.parent && that.config.parent._lock) {
			that.lock();
		}
		that.unlock();
		
		if( that._maxState )
		{
			_$html.removeClass('ui_lock_scroll');
		    DOM.res[0].style.display = 'none';
		}
		
		if( lhgdialog.focus === that ) lhgdialog.focus = null;
		
		that._removeEvent();
		delete list[that.config.id];
		
		// ç§»é™¤HTMLElementæˆ–é‡ç”?
		if( _singleton )
		    wrap.remove();
		else
		{
		    _singleton = that;
			
			if( that._minState )
			{
				DOM.main[0].style.display = '';
				DOM.buttons[0].style.display = '';
				DOM.dialog[0].style.width = '';
			}
			
			DOM.wrap[0].style.cssText = 'left:0;top:0;';
			DOM.wrap[0].className = '';
			DOM.wrap[0].style.display = 'none';
		    DOM.border.removeClass('ui_state_focus');
		    DOM.title[0].innerHTML = '';
		    DOM.content.html('');
			DOM.icon[0].innerHTML = '';
		    DOM.buttons[0].innerHTML = '';
			
			that.hide(true)._setAbsolute();
		
		    // æ¸…ç©ºé™¤this.DOMä¹‹å¤–ä¸´æ—¶å¯¹è±¡ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼Œä»¥ä¾¿ä½¿ç”¨å•ä¾‹æ¨¡å¼
		    for( var i in that )
		    {
			    if(that.hasOwnProperty(i) && i !== 'DOM') delete that[i];
		    };
		}
		
		that.closed = true;
		return that;
	},
	
	/*! æœ€å¤§åŒ–çª—å£ */
	max: function()
	{
		var that = this, maxSize,
		    DOM = that.DOM,
			wrapStyle = DOM.wrap[0].style,
			mainStyle = DOM.main[0].style,
			rbStyle = DOM.rb[0].style,
			titleStyle = DOM.title[0].style,
			config = that.config,
		    top = _$top.scrollTop(),
		    left = _$top.scrollLeft();
		
		if( !that._maxState )
		{
		
			_$html.addClass('ui_lock_scroll');
			
			if( that._minState )
			    that.min();
			
			// å­˜å‚¨æœ€å¤§åŒ–çª—å£å‰çš„çŠ¶æ€?
			that._or = {
				t: wrapStyle.top,
				l: wrapStyle.left,
				w: mainStyle.width,
				h: mainStyle.height,
				d: config.drag,
				r: config.resize,
				rc: rbStyle.cursor,
				tc: titleStyle.cursor
			};
			
			wrapStyle.top = top + 'px';
			wrapStyle.left = left + 'px';
			
			maxSize = that._maxSize();
			that.size( maxSize.w, maxSize.h )._setAbsolute();
			
			if( _ie6 && _doctype )
			    wrapStyle.width = _$top.width() + 'px';
			
			config.drag = false;
			config.resize = false;
			rbStyle.cursor = 'auto';
			titleStyle.cursor = 'auto';
			
			DOM.max[0].style.display = 'none';
			DOM.res[0].style.display = 'inline-block';
			
			that._maxState = true;
		}
		else
		{
			_$html.removeClass('ui_lock_scroll');
			
			wrapStyle.top = that._or.t;
			wrapStyle.left = that._or.l;
			that.size( that._or.w, that._or.h )._autoPositionType();
			config.drag = that._or.d;
		    config.resize = that._or.r;
		    rbStyle.cursor = that._or.rc;
		    titleStyle.cursor = that._or.tc;
		
		    DOM.res[0].style.display = 'none';
			DOM.max[0].style.display = 'inline-block';
			
			delete that._or;
			
			that._maxState = false;
		}
		
		return that;
	},
	
	/*! æœ€å°åŒ–çª—å£ */
	min: function()
	{
		var that = this,
		    DOM = that.DOM,
			main = DOM.main[0].style,
			buttons = DOM.buttons[0].style,
			dialog = DOM.dialog[0].style,
			rb = DOM.rb[0].style.cursor,
			resize = that.config.resize;
			
		if( !that._minState )
		{
		    if( that._maxState )
				that.max();
			
			that._minRz = {rzs:resize,btn:buttons.display};
			main.display = 'none';
		    buttons.display = 'none';
		    dialog.width = main.width;
			rb.cursor = 'auto';
			resize = false;
		
		    that._minState = true;
		}
		else
		{
		    main.display = '';
			buttons.display = that._minRz.btn;
			dialog.width = '';
			resize = that._minRz;
			rb.cursor = that._minRz.rzs ? 'se-resize' : 'auto';
			
			delete that._minRz;
			
			that._minState = false;
		}
		
		that._ie6SelectFix();
		
		return that;
	},
	
	/*!
	 * è·å–æŒ‡å®šidçš„çª—å£å¯¹è±¡æˆ–çª—å£ä¸­iframeåŠ è½½çš„å†…å®¹é¡µçš„windowå¯¹è±¡
	 * @param {String} æŒ‡å®šçš„id
	 * @param {String} æ˜¯å¦è¿”å›çš„ä¸ºæŒ‡å®šidçš„çª—å£å¯¹è±?
	 *        ç”¨æ•°å­?æ¥è¡¨ç¤ºçœŸï¼Œå¦‚æœä¸å†™æˆ–å†™å…¶å®ƒä¸ºfalse
	 * @return {Object|null}
	 */
	get: function( id, object )
	{
		if( lhgdialog.list[id] )
		{
			if( object === 1 )
			    return lhgdialog.list[id];
			else
			    return lhgdialog.list[id].content || null;
		}
		
		return null;
	},
	
	/**
	 * åˆ·æ–°æˆ–è·³è½¬æŒ‡å®šé¡µé?
	 * @param	{Object, æŒ‡å®šé¡µé¢çš„windowå¯¹è±¡}
	 * @param	{String, è¦è·³è½¬åˆ°çš„é¡µé¢åœ°å€}
	 */
	reload: function( win, url, callback )
	{
	    win = win || window;
		
		try{
		    win.location.href = url ? url : win.location.href;
		}
		catch(e){ // è·¨åŸŸ
			url = this.iframe.src;
			$(this.iframe).attr('src', url);
		};
		
		callback && callback.call( this );
		
		return this;
	},
	
	/*!
	 * è®¾ç½®iframeæ–¹å¼åŠ è½½å†…å®¹é¡?
	 */
	_iframe: function( url )
	{
	    var that = this, iframe, $iframe, iwin, $idoc, $ibody, iWidth, iHeight,
		    $content = that.DOM.content,
			config = that.config,
			loading = that._load = $('.ui_loading',$content[0])[0],
		    initCss = 'position:absolute;left:-9999em;border:none 0;background:transparent',
		    loadCss = 'width:100%;height:100%;border:none 0;';
		
		// æ˜¯å¦å…è®¸ç¼“å­˜. é»˜è®¤true
		if( config.cache === false )
		{
			var ts = (new Date).getTime(),
				ret = url.replace(/([?&])_=[^&]*/, '$1_=' + ts );
			url = ret + ((ret === url) ? (/\?/.test(url) ? '&' : '?') + '_=' + ts : '');
		}
			
		iframe = that.iframe = _doc.createElement('iframe');
		iframe.name = config.id;
		iframe.style.cssText = initCss;
		iframe.setAttribute('frameborder', 0, 0);
		
		$iframe = $(iframe);
		$content[0].appendChild( iframe );
		
		// å»¶è¿ŸåŠ è½½iframeçš„srcå±æ€§ï¼ŒIE6ä¸‹ä¸å»¶è¿ŸåŠ è½½ä¼šå‡ºç°åŠ è½½è¿›åº¦æ¡çš„BUG
		that._frmTimer = setTimeout(function(){
		    $iframe.attr('src', url);
		}, 1);
		
		// iframeä¸­é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œçš„å‡½æ•?
		var load = that._fmLoad = function()
		{
			$content.addClass('ui_state_full');
			
			// å¢å¼ºçª—å£ç½®é¡¶åŠŸèƒ½ï¼Œiframeæ–¹å¼åŠ è½½å†…å®¹æˆ–è·¨åŸŸåŠ è½½å†…å®¹é¡µæ—¶ç‚¹çª—å£å†…å®¹éƒ¨åˆ†ç½®é¡¶çª—å£
			// é€šè¿‡ä½¿ç”¨é‡ç½®loadingå±‚æ¥ä¼˜é›…çš„å®Œæˆæ­¤åŠŸèƒ½ï¼Œåœ¨focusæ–¹æ³•ä¸­æœ‰æ­¤åŠŸèƒ½çš„ç›¸å…³ä»£ç 
			var DOM = that.DOM, ltSize,
			    lt = DOM.lt[0].offsetHeight,
				main = DOM.main[0].style;
				
			loading.style.cssText = 'display:none;position:absolute;background:#FFF;opacity:0;' + 
			    'filter:alpha(opacity=0);z-index:1;width:' + main.width + ';height:' + main.height + ';';
			// æ­¤éƒ¨åˆ†ä»£ç ç»“æŸï¼Œåœ¨æ‹–åŠ¨æ”¹å˜å¤§å°çš„_dragEvent.onmoveæ–¹æ³•ä¸­è¿˜æœ‰æ­¤åŠŸèƒ½çš„ç›¸å…³ä»£ç ?
			
			try{
			    iwin = that.content = iframe.contentWindow; // å®šä¹‰çª—å£å¯¹è±¡contentå±æ€§ä¸ºå†…å®¹é¡µçš„windowå¯¹è±¡
				$idoc = $(iwin.document);
				$ibody = $(iwin.document.body);
			}catch(e){// è·¨åŸŸ
			    iframe.style.cssText = loadCss;
				return;
			}
			// è·å–iframeå†…éƒ¨å°ºå¯¸
			iWidth = config.width === 'auto'
			? $idoc.width() + (_ie6 ? 0 : parseInt($ibody.css('marginLeft')))
			: config.width;
			
			iHeight = config.height === 'auto'
			? $idoc.height() : config.height;
			
			// é€‚åº”iframeå°ºå¯¸
			setTimeout(function(){
			    iframe.style.cssText = loadCss;
			},0);// setTimeout: é˜²æ­¢IE6~7å¯¹è¯æ¡†æ ·å¼æ¸²æŸ“å¼‚å¸?
		
			// çª—å£æœ€å¤§åŒ–æ—¶è¿™é‡Œä¸ç”¨å†è®¡ç®—çª—å£çš„å°ºå¯¸å’Œä½ç½®äº†ï¼Œå¦‚æœå†è®¡ç®—çª—å£ä¼šå‡ºç°é”™ä½
			if( !that._maxState )
			{
			    that.size( iWidth, iHeight )
			    .position( config.left, config.top );
			}
			
			// éè·¨åŸŸæ—¶è¿˜è¦å¯¹loadingå±‚é‡è®¾å¤§å°ï¼Œè¦ä¸å®½å’Œåº¦éƒ½ä¸?auto'
			loading.style.width = main.width;
			loading.style.height = main.height;
			
			config.init && config.init.call( that, iwin, _top );
		};
		
		// ç»‘å®šiframeå…ƒç´ apiå±æ€§ä¸ºçª—å£è‡ªèº«å¯¹è±¡ï¼Œåœ¨å†…å®¹é¡µä¸­æ­¤å±æ€§å¾ˆé‡è¦
		that.iframe.api = that;
		$iframe.bind( 'load', load );
	},
	
	/*! è·å–çª—å£å…ƒç´  */
	_getDOM: function()
	{
		var wrap = _doc.createElement('div'),
		    body = _doc.body;
		
		wrap.style.cssText = 'position:absolute;left:0;top:0;visibility:hidden;';
		wrap.innerHTML = dialogTpl;
		
        var name, i = 0,
			DOM = { wrap: $(wrap) },
			els = wrap.getElementsByTagName('*'),
			len = els.length;
			
		for( ; i < len; i ++ )
		{
			name = els[i].className.split('ui_')[1];
			if(name) DOM[name] = $(els[i]);
		};
		
		body.insertBefore(wrap, body.firstChild);
		
		return DOM;
	},
	
	/*!
	 * pxä¸?å•ä½è½¬æ¢æˆæ•°å€?(ç™¾åˆ†æ¯”å•ä½æŒ‰ç…§æœ€å¤§å€¼æ¢ç®?
	 * å…¶ä»–çš„å•ä½è¿”å›åŸå€?
	 */
	_toNumber: function( thisValue, maxValue )
	{
		if( typeof thisValue === 'number' )
			return thisValue;
		
		if( thisValue.indexOf('%') !== -1 )
			thisValue = parseInt(maxValue * thisValue.split('%')[0] / 100);
		
		return thisValue;
	},
	
	/*! è®¡ç®—æœ€å¤§åŒ–çª—å£æ—¶çª—å£çš„å°ºå¯¸ */
	_maxSize: function()
	{
	    var that = this, DOM = that.DOM,
		    wrap = DOM.wrap[0],
			main = DOM.main[0],
			maxWidth, maxHeight;
			
		maxWidth = _$top.width() - wrap.offsetWidth + main.offsetWidth;
		maxHeight = _$top.height() - wrap.offsetHeight + main.offsetHeight;
		
		return { w: maxWidth, h: maxHeight };
	},
	
	/*! è®©IE6 CSSæ”¯æŒPNGèƒŒæ™¯ */
	_ie6PngFix: function()
	{
	    if( _ie6 )
		{
			var i = 0, elem, png, pngPath, runtimeStyle,
				path = lhgdialog.setting.path + '/skins/',
				list = this.DOM.wrap[0].getElementsByTagName('*');
			
			for( ; i < list.length; i ++ )
			{
				elem = list[i];
				png = elem.currentStyle['png'];
				if( png )
				{
					pngPath = path + png;
					runtimeStyle = elem.runtimeStyle;
					runtimeStyle.backgroundImage = 'none';
					runtimeStyle.filter = "progid:DXImageTransform.Microsoft." +
						"AlphaImageLoader(src='" + pngPath + "',sizingMethod='scale')";
				};
			}
		}
		
		return this;
	},
	
	/*! å¼ºåˆ¶è¦†ç›–IE6ä¸‹æ‹‰æ§ä»¶ */
	_ie6SelectFix: _ie6 ? function(){
		var $wrap = this.DOM.wrap,
			wrap = $wrap[0],
			expando = expando + 'iframeMask',
			iframe = $wrap[expando],
			width = wrap.offsetWidth,
			height = wrap.offsetHeight;

		width = width + 'px';
		height = height + 'px';
		if(iframe)
		{
			iframe.style.width = width;
			iframe.style.height = height;
		}else{
			iframe = wrap.appendChild(_doc.createElement('iframe'));
			$wrap[expando] = iframe;
			iframe.src = "javascript:''";
			iframe.style.cssText = 'position:absolute;z-index:-1;left:0;top:0;'
			+ 'filter:alpha(opacity=0);width:' + width + ';height:' + height;
		}
	} : _fn,
	
	/*! è‡ªåŠ¨åˆ‡æ¢å®šä½ç±»å‹ */
	_autoPositionType: function()
	{
		this[this.config.fixed ? '_setFixed' : '_setAbsolute']();
	},
	
	/*! è®¾ç½®é™æ­¢å®šä½ */
	_setFixed: function( el )
	{
		var style = el ? el.style : this.DOM.wrap[0].style;
		
		if( _ie6 )
		{
			var sLeft = _$top.scrollLeft(),
				sTop = _$top.scrollTop(),
				left = parseInt(style.left) - sLeft,
				top = parseInt(style.top) - sTop,
				txt = _doctype ? 'this.ownerDocument.body' :
				    'this.ownerDocument.documentElement';
			
			this._setAbsolute();
			
			style.setExpression( 'left', txt + '.scrollLeft +' + left );
			style.setExpression( 'top', txt + '.scrollTop +' + top );
		}
		else
			style.position = 'fixed';
	},
	
	/*! è®¾ç½®ç»å¯¹å®šä½ */
	_setAbsolute: function()
	{
		var style = this.DOM.wrap[0].style;
			
		if(_ie6)
		{
			style.removeExpression('left');
			style.removeExpression('top');
		}

		style.position = 'absolute';
	},
	
	/*! æŒ‰é’®å›è°ƒå‡½æ•°è§¦å‘ */
	_click: function( name )
	{ 
		var that = this,
			fn = that._listeners[name] && that._listeners[name].callback;
		return typeof fn !== 'function' || fn.call(that, window) !== false ?
			that.close() : that;
	},
	
	/*! é‡ç½®ä½ç½®ä¸å°ºå¯?*/
	_reset: function()
	{
		var test = !!window.ActiveXObject,
		    newSize,
			that = this,
			tw = _$top.width(),
			tt = _$top.height(),
			oldSize = that._winSize || tw * tt,
			oldWidth = that._lockDocW || tw,
			left = that._left,
			top = that._top;
		
		if(test)
		{
			//IE6ä¸‹é®ç½©å¤§å°æ”¹å?
			if( that._lock && _ie6 )
			    $('#ldg_lockmask',_doc).css({ width:tw + 'px', height:tt + 17 + 'px' });
			
			newWidth = that._lockDocW = tw;
			//IE6~7 window.onresize bug
			newSize = that._winSize =  tw * tt;
			if( oldSize === newSize ) return;
		};
		
		if( that._maxState )
		{
		    var size = that._maxSize();
			that.size( size.w, size.h );
		}
		
		//IE6~8ä¼šå‡ºç°æœ€å¤§åŒ–è¿˜åŸåçª—å£é‡æ–°å®šä½ï¼Œé”å®šæ»šåŠ¨æ¡åœ¨IEä¸‹å°±ä¼šè§¦å‘resizeäº‹ä»¶BUG 
		if( test && Math.abs(oldWidth - newWidth) === 17 ) return;
		
		if( left || top )
			that.position( left, top );
	},
	
	_addEvent: function()
	{
		var resizeTimer,
			that = this,
			config = that.config,
			DOM = that.DOM;
		
		// çª—å£è°ƒèŠ‚äº‹ä»¶
		that._winResize = function()
		{
			resizeTimer && clearTimeout(resizeTimer);
			resizeTimer = setTimeout(function()
			{
				that._reset();
			}, 140);
		};
		_$top.bind('resize', that._winResize);
		
		// ç›‘å¬ç‚¹å‡»
		DOM.wrap.bind('click', function(event){
			var target = event.target, callbackID;
			
			if( target.disabled ) return false; // IE BUG
			
			if( target === DOM.close[0] )
			{
				that._click('cancel');
				return false;
			}
			else if( target === DOM.max[0] || target === DOM.res[0] || target === DOM.max_b[0]
			    || target === DOM.res_b[0] || target === DOM.res_t[0] )
			{
			    that.max();
				return false;
			}
			else if( target === DOM.min[0] || target === DOM.min_b[0] )
			{
				that.min();
				return false;
			}
			else
			{
				callbackID = target[expando + 'callback'];
				callbackID && that._click(callbackID);
			}
		}).bind('mousedown',function(event){
		    that.zindex();
			
			var target = event.target;
			
			if( config.drag !== false && target === DOM.title[0]
			|| config.resize !== false && target === DOM.rb[0] )
			{
				_use(event);
				return false;
			}
		});
		
		// åŒå‡»æ ‡é¢˜æ æœ€å¤§åŒ–è¿˜çª—å£äº‹ä»?
		if( config.max )
		    DOM.title.bind('dblclick',function(){ that.max(); return false; });
	},
	
	/*!  å¸è½½äº‹ä»¶ä»£ç† */
	_removeEvent: function()
	{
		var that = this,
			DOM = that.DOM;
		
		DOM.wrap.unbind();
		DOM.title.unbind();
		_$top.unbind('resize', that._winResize);
	}
};

lhgdialog.fn._init.prototype = lhgdialog.fn;

/*! æ­¤å¯¹è±¡ç”¨æ¥å­˜å‚¨è·å¾—ç„¦ç‚¹çš„çª—å£å¯¹è±¡å®ä¾‹ */
lhgdialog.focus = null;

/*! å­˜å‚¨çª—å£å®ä¾‹çš„å¯¹è±¡åˆ—è¡?*/
lhgdialog.list = {};

/*!
 * å…¨å±€å¿«æ·é”?
 * ç”±äºè·¨æ¡†æ¶æ—¶äº‹ä»¶æ˜¯ç»‘å®šåˆ°æœ€é¡¶å±‚é¡µé¢ï¼Œæ‰€ä»¥å½“å½“å‰é¡µé¢å¸è½½æ—¶å¿…é¡»è¦é™¤ç§»æ­¤äº‹ä»?
 * æ‰€ä»¥å¿…é¡»unbindæ­¤äº‹ä»¶ç»‘å®šçš„å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œè¦ç»™ç»‘å®šçš„äº‹ä»¶å®šä¹‰ä¸ªå‡½æ•?
 * è¿™æ ·åœ¨å½“å‰é¡µé¢å¸è½½æ—¶å°±å¯ä»¥ç§»æ­¤äº‹ä»¶ç»‘å®šçš„ç›¸åº”å‡½æ•°ï¼Œä¸è€Œä¸å½±å“é¡¶å±‚é¡µé¢æ­¤äº‹ä»¶ç»‘å®šçš„å…¶å®ƒå‡½æ•°
 */
onKeyDown = function(event)
{
	var target = event.target,
		api = lhgdialog.focus,
		keyCode = event.keyCode;

	if( !api || !api.config.esc || api.config.cancel === false ) return;
		
	keyCode === 27 && api._click(api.config.cancelVal);
};

_$doc.bind('keydown',onKeyDown);

/*!
 * æ¡†æ¶é¡µé¢å¸è½½å‰å…³é—­æ‰€æœ‰ç©¿è¶Šçš„å¯¹è¯æ¡?
 * åŒæ—¶ç§»é™¤æ‹–åŠ¨å±‚å’Œé®ç½©å±?
 */
_top != window && $(window).bind('unload',function()
{
    var list = lhgdialog.list;
	for( var i in list )
	{
	    if(list[i])
		    list[i].close();
	}
	_singleton && _singleton.DOM.wrap.remove();
	
	_$doc.unbind('keydown',onKeyDown);
	
	$('#ldg_lockmask',_doc)[0] && $('#ldg_lockmask',_doc).remove();
	$('#ldg_dragmask',_doc)[0] && $('#ldg_dragmask',_doc).remove();
});

/*! lhgdialog çš„å…¨å±€é»˜è®¤é…ç½® */
lhgdialog.setting =
{
    content: '<div class="ui_loading"><span>loading...</span></div>',
	title: '\u89C6\u7A97 ',     // æ ‡é¢˜,é»˜è®¤'è§†çª—'
	button: null,	     		// è‡ªå®šä¹‰æŒ‰é’?
	ok: null,					// ç¡®å®šæŒ‰é’®å›è°ƒå‡½æ•°
	cancel: null,				// å–æ¶ˆæŒ‰é’®å›è°ƒå‡½æ•°
	init: null,					// å¯¹è¯æ¡†åˆå§‹åŒ–åæ‰§è¡Œçš„å‡½æ•°
	close: null,				// å¯¹è¯æ¡†å…³é—­å‰æ‰§è¡Œçš„å‡½æ•?
	okVal: '\u786E\u5B9A',		// ç¡®å®šæŒ‰é’®æ–‡æœ¬,é»˜è®¤'ç¡®å®š'
	cancelVal: '\u53D6\u6D88',	// å–æ¶ˆæŒ‰é’®æ–‡æœ¬,é»˜è®¤'å–æ¶ˆ'
	skin: '',					// å¤šçš®è‚¤å…±å­˜é¢„ç•™æ¥å?
	esc: true,					// æ˜¯å¦æ”¯æŒEscé”®å…³é—?
	show: true,					// åˆå§‹åŒ–åæ˜¯å¦æ˜¾ç¤ºå¯¹è¯æ¡?
	width: 'auto',				// å†…å®¹å®½åº¦
	height: 'auto',				// å†…å®¹é«˜åº¦
	icon: null,					// æ¶ˆæ¯å›¾æ ‡åç§°
	path: _path,                // lhgdialogè·¯å¾„
	lock: false,				// æ˜¯å¦é”å±
	focus: true,                // çª—å£æ˜¯å¦è‡ªåŠ¨è·å–ç„¦ç‚¹
	parent: null,               // æ‰“å¼€å­çª—å£çš„çˆ¶çª—å£å¯¹è±¡ï¼Œä¸»è¦ç”¨äºå¤šå±‚é”å±çª—å£
	background: '#DCE2F1',		// é®ç½©é¢œè‰²
	opacity: .6,				// é®ç½©é€æ˜åº?
	padding: '10px',		    // å†…å®¹ä¸è¾¹ç•Œå¡«å……è·ç¦?
	fixed: false,				// æ˜¯å¦é™æ­¢å®šä½
	left: '50%',				// Xè½´åæ ?
	top: '38.2%',				// Yè½´åæ ?
	max: true,                  // æ˜¯å¦æ˜¾ç¤ºæœ€å¤§åŒ–æŒ‰é’®
	min: true,                  // æ˜¯å¦æ˜¾ç¤ºæœ€å°åŒ–æŒ‰é’®
	zIndex: 1976,				// å¯¹è¯æ¡†å åŠ é«˜åº¦å€?é‡è¦ï¼šæ­¤å€¼ä¸èƒ½è¶…è¿‡æµè§ˆå™¨æœ€å¤§é™åˆ?
	resize: true,				// æ˜¯å¦å…è®¸ç”¨æˆ·è°ƒèŠ‚å°ºå¯¸
	drag: true, 				// æ˜¯å¦å…è®¸ç”¨æˆ·æ‹–åŠ¨ä½ç½®
	cache: true,                // æ˜¯å¦ç¼“å­˜çª—å£å†…å®¹é¡?
	data: null,                 // ä¼ é€’å„ç§æ•°æ?
	extendDrag: false           // å¢åŠ lhgdialogæ‹–æ‹½ä½“éªŒ
};

/*!
 *------------------------------------------------
 * å¯¹è¯æ¡†æ¨¡å?æ‹–æ‹½æ”¯æŒï¼ˆå¯é€‰å¤–ç½®æ¨¡å—ï¼‰
 *------------------------------------------------
 */
var _use, _isSetCapture = 'setCapture' in _root,
	_isLosecapture = 'onlosecapture' in _root;

lhgdialog.dragEvent =
{
    onstart: _fn,
	start: function(event)
	{
	    var that = lhgdialog.dragEvent;
		
		_$doc
		.bind( 'mousemove', that.move )
		.bind( 'mouseup', that.end );
		
		that._sClientX = event.clientX;
		that._sClientY = event.clientY;
		that.onstart( event.clientX, event.clientY );
		
		return false;
	},
	
	onmove: _fn,
	move: function(event)
	{
	    var that = lhgdialog.dragEvent;
		
		that.onmove(
		    event.clientX - that._sClientX,
			event.clientY - that._sClientY
		);
		
		return false;
	},
	
	onend: _fn,
	end: function(event)
	{
	    var that = lhgdialog.dragEvent;
		
		_$doc
		.unbind('mousemove', that.move)
		.unbind('mouseup', that.end);
		
		that.onend(  event.clientX, event.clientY );
		return false;
	}
};

_use = function(event)
{
	var limit, startWidth, startHeight, startLeft, startTop, isResize,
		api = lhgdialog.focus,
		config = api.config,
		DOM = api.DOM,
		wrap = DOM.wrap[0],
		title = DOM.title,
		main = DOM.main[0],
		_dragEvent = lhgdialog.dragEvent,
	
	// æ¸…é™¤æ–‡æœ¬é€‰æ‹©
	clsSelect = 'getSelection' in _top ?
	function(){
		_top.getSelection().removeAllRanges();
	}:function(){
		try{_doc.selection.empty();}catch(e){};
	};
	
	// å¯¹è¯æ¡†å‡†å¤‡æ‹–åŠ?
	_dragEvent.onstart = function( x, y )
	{
		if( isResize )
		{
			startWidth = main.offsetWidth;
			startHeight = main.offsetHeight;
		}
		else
		{
			startLeft = wrap.offsetLeft;
			startTop = wrap.offsetTop;
		};
		
		_$doc.bind( 'dblclick', _dragEvent.end );
		
		!_ie6 && _isLosecapture
		? title.bind('losecapture',_dragEvent.end )
		: _$top.bind('blur',_dragEvent.end);
		
		_isSetCapture && title[0].setCapture();
		
		DOM.border.addClass('ui_state_drag');
		api.focus();
	};
	
	// å¯¹è¯æ¡†æ‹–åŠ¨è¿›è¡Œä¸­
	_dragEvent.onmove = function( x, y )
	{
		if( isResize )
		{
			var wrapStyle = wrap.style,
				style = main.style,
				width = x + startWidth,
				height = y + startHeight;
			
			wrapStyle.width = 'auto';
			config.width = style.width = Math.max(0,width) + 'px';
			wrapStyle.width = wrap.offsetWidth + 'px';
			
			config.height = style.height = Math.max(0,height) + 'px';
			//api._ie6SelectFix();
		    // ä½¿ç”¨loadingå±‚ç½®é¡¶çª—å£æ—¶çª—å£å¤§å°æ”¹å˜ç›¸åº”loadingå±‚å¤§å°ä¹Ÿå¾—æ”¹å?
			api._load && $(api._load).css({width:style.width, height:style.height});
		}
		else
		{
			var style = wrap.style,
				left = x + startLeft,
				top = y + startTop;

			config.left = Math.max( limit.minX, Math.min(limit.maxX,left) );
			config.top = Math.max( limit.minY, Math.min(limit.maxY,top) );
			style.left = config.left + 'px';
			style.top = config.top + 'px';
		}
			
		clsSelect();
	};
	
	// å¯¹è¯æ¡†æ‹–åŠ¨ç»“æ?
	_dragEvent.onend = function( x, y )
	{
		_$doc.unbind('dblclick',_dragEvent.end);
		
		!_ie6 && _isLosecapture
		? title.unbind('losecapture',_dragEvent.end)
		: _$top.unbind('blur',_dragEvent.end);
		
		_isSetCapture && title[0].releaseCapture();
		
		_ie6 && api._autoPositionType();
		
		DOM.border.removeClass('ui_state_drag');
	};
	
	isResize = event.target === DOM.rb[0] ? true : false;
	
	limit =	(function(fixed)
	{
		var	ow = wrap.offsetWidth,
			// å‘ä¸‹æ‹–åŠ¨æ—¶ä¸èƒ½å°†æ ‡é¢˜æ æ‹–å‡ºå¯è§†åŒºåŸ?
			oh = title[0].offsetHeight || 20,
			ww = _$top.width(),
			wh = _$top.height(),
			dl = fixed ? 0 : _$top.scrollLeft(),
			dt = fixed ? 0 : _$top.scrollTop();
		    // åæ ‡æœ€å¤§å€¼é™åˆ?åœ¨å¯è§†åŒºåŸŸå†…)	
		    maxX = ww - ow + dl;
		    maxY = wh - oh + dt;
		
		return {
			minX: dl,
			minY: dt,
			maxX: maxX,
			maxY: maxY
		};
	})(wrap.style.position === 'fixed');
	
	_dragEvent.start(event);
};

/*! 
 * é¡µé¢DOMåŠ è½½å®Œæˆæ‰§è¡Œçš„ä»£ç ?
 */
$(function(){
	// è§¦å‘æµè§ˆå™¨é¢„å…ˆç¼“å­˜èƒŒæ™¯å›¾ç‰?
	setTimeout(function()
	{
	    if(_count) return;
		lhgdialog({left:'-9999em',time:9,fixed:false,lock:false,focus:false});
	},150);
	
	// å¢å¼ºlhgdialogæ‹–æ‹½ä½“éªŒï¼ˆå¯é€‰å¤–ç½®æ¨¡å—ï¼Œå¦‚ä¸éœ€è¦å¯åˆ é™¤ï¼?
	// é˜²æ­¢é¼ æ ‡è½å…¥iframeå¯¼è‡´ä¸æµç•…ï¼Œå¯¹è¶…å¤§å¯¹è¯æ¡†æ‹–åŠ¨ä¼˜åŒ–
	lhgdialog.setting.extendDrag &&
	(function(dragEvent){
	    var mask = _doc.createElement('div'),
		    style = mask.style,
			positionType = _ie6 ? 'absolute' : 'fixed';
		mask.id = 'ldg_dragmask';
		
		style.cssText = 'display:none;position:' + positionType + ';left:0;top:0;width:100%;height:100%;'
		+ 'cursor:move;filter:alpha(opacity=0);opacity:0;background:#FFF;pointer-events:none;';
		
		_doc.body.appendChild(mask);
		
		dragEvent._start = dragEvent.start;
		dragEvent._end = dragEvent.end;
		
		dragEvent.start = function()
		{
			var api = lhgdialog.focus,
				main = api.DOM.main[0],
				iframe = api.iframe;
			
			dragEvent._start.apply(this, arguments);
			style.display = 'block';
			style.zIndex = lhgdialog.setting.zIndex + 3;
			
			if(positionType === 'absolute')
			{
				style.width = _$top.width() + 'px';
				style.height = _$top.height() + 'px';
				style.left = _$doc.scrollLeft() + 'px';
				style.top = _$doc.scrollTop() + 'px';
			};
			
			if( iframe && main.offsetWidth * main.offsetHeight > 307200 )
				main.style.visibility = 'hidden';
		};
		
		dragEvent.end = function()
		{
			var api = lhgdialog.focus;
			dragEvent._end.apply(this, arguments);
			style.display = 'none';
			if(api) api.DOM.main[0].style.visibility = 'visible';
		};
	})(lhgdialog.dragEvent);
});

/*! ä½¿ç”¨jQæ–¹å¼è°ƒç”¨çª—å£ */
$.fn.dialog = function()
{
	var config = arguments;
	this.bind('click',function(){ lhgdialog.apply(this,config); return false; });
	return this;
};
		
window.lhgdialog = $.dialog = lhgdialog;

})( this.jQuery || this.lhgcore, this );

/*!
 *------------------------------------------------
 * å¯¹è¯æ¡†å…¶å®ƒåŠŸèƒ½æ‰©å±•æ¨¡å—ï¼ˆå¯é€‰å¤–ç½®æ¨¡å—ï¼‰
 *------------------------------------------------
 */
;(function( $, lhgdialog, undefined ){

var _zIndex = function()
{
    return lhgdialog.setting.zIndex;
};

/**
 * è­¦å‘Š
 * @param	{String}	æ¶ˆæ¯å†…å®¹
 */
lhgdialog.alert = function( content, callback, parent )
{
	return lhgdialog({
		title: 'è­¦å‘Š',
		id: 'Alert',
		zIndex: _zIndex(),
		icon: 'alert.gif',
		fixed: true,
		lock: true,
		content: content,
		ok: true,
		resize: false,
		close: callback,
		parent: parent || null
	});
};

/**
 * ç¡®è®¤
 * @param	{String}	æ¶ˆæ¯å†…å®¹
 * @param	{Function}	ç¡®å®šæŒ‰é’®å›è°ƒå‡½æ•°
 * @param	{Function}	å–æ¶ˆæŒ‰é’®å›è°ƒå‡½æ•°
 */
lhgdialog.confirm = function( content, yes, no, parent )
{
	return lhgdialog({
		title: 'ç¡®è®¤',
		id: 'confirm.gif',
		zIndex: _zIndex(),
		icon: 'confirm.gif',
		fixed: true,
		lock: true,
		content: content,
		resize: false,
		parent: parent || null,
		ok: function(here){
			return yes.call(this, here);
		},
		cancel: function(here){
			return no && no.call(this, here);
		}
	});
};

/**
 * æé—®
 * @param	{String}	æé—®å†…å®¹
 * @param	{Function}	å›è°ƒå‡½æ•°. æ¥æ”¶å‚æ•°ï¼šè¾“å…¥å€?
 * @param	{String}	é»˜è®¤å€?
 */
lhgdialog.prompt = function( title, content, yes, value, parent )
{
	value = value || '';
	var input;
	
	return lhgdialog({
		title: title,
		id: 'Prompt',
		zIndex: _zIndex(),
		icon: 'prompt.gif',
		fixed: true,
		lock: true,
		parent: parent || null,
		content: [
			'<div style="margin-bottom:5px;font-size:12px">',
				content,
			'</div>',
			'<div>',
				'<input  value="',
					value,
				'" style="width:18em;padding:6px 4px;border:1px solid black;" />',
			'</div>'
			].join(''),
		init: function(){
			input = this.DOM.content[0].getElementsByTagName('input')[0];
			input.select();
			input.focus();
		},
		ok: function(here){
			return yes && yes.call(this, input.value, here);
		},
		cancel: true
	});
};

/**
 * çŸ­æš‚æç¤º
 * @param	{String}	æç¤ºå†…å®¹
 * @param   {Number}    æ˜¾ç¤ºæ—¶é—´ (é»˜è®¤1.5ç§?
 * @param	{String}	æç¤ºå›¾æ ‡ (æ³¨æ„è¦åŠ æ‰©å±•å?
 * @param   {Function}  æç¤ºå…³é—­æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°
 */
lhgdialog.tips = function( content, time, icon, callback )
{
	var reIcon = icon ? function(){
		this.DOM.icon[0].innerHTML = '<img src="' + this.config.path + 'skins/icons/' + icon + '" class="ui_icon_bg"/>';
		this.DOM.icon[0].style.display = '';
		if( callback ) this.config.close = callback;
	} : function(){
	    this.DOM.icon[0].style.display = 'none';
		if( callback ) this.config.close = callback;
	};
	
	return lhgdialog({
		id: 'Tips',
		zIndex: _zIndex(),
		title: false,
		cancel: false,
		fixed: true,
		lock: false,
		resize: false
	})
	.content(content)
	.time(time || 1.5, reIcon);
};

})( this.jQuery||this.lhgcore, this.lhgdialog );